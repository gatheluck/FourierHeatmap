version: "3.8"

services:
  fhmap:
    build:
      context: ../../
      dockerfile: provision/docker/Dockerfile
      shm_size: 30G
    command: arch=${ARCH} batch_size=${BATCH_SIZE} dataset=${DATASET} eps=${EPS} ignore_edge_size=${IGNORE_EDGE_SIZE} num_samples=${NUM_SAMPLES} weightpath=/root/scratch/FourierHeatmap/weight/${WEIGHTFILE}
    ports:
      - 9000:8000
    # This is required for use GPU in the container
    runtime: nvidia
    volumes:
      - type: bind
        source: ${HOST_DATADIR}
        target: /root/scratch/FourierHeatmap/data
      - type: bind
        source: ${HOST_OUTPUTSDIR}
        target: /root/scratch/FourierHeatmap/outputs
      - type: bind
        source: ${HOST_WEIGHTDIR}
        target: /root/scratch/FourierHeatmap/weight
